function mr_section_init(a){function e(b,c){if(b.files&&b.files[0]){var e=new FileReader,f=$("<img />"),h=$("<span>âœ–</span>"),i=b.files[0].type.toString();if("image"!==i.split("/")[0])return $(b).val(""),!1;e.onload=function(b){var e=g(b.target.result,i),j=URL.createObjectURL(e);h.addClass("mr-preview-remove-img-section"),f.addClass("mr-preview-img-section").attr("src",j),c.empty(),c.append(f),c.length&&c.append(d),c.parents(".mr-section-base:eq(0)").length&&c.parents(".mr-section-base:eq(0)").find(".mr-remove-input").length&&c.parents(".mr-section-base:eq(0)").find(".mr-remove-input").val(0),f.init_crop({nav_block:c.siblings(".mr-control-panel"),width:a.width,height:a.height,data_block:c.siblings(".mr-data-inputs")}),c.siblings(".mr-data-inputs").find(".mr-origin-height").val(f.height()),c.siblings(".mr-data-inputs").find(".mr-origin-width").val(f.width())},e.readAsDataURL(b.files[0])}}function f(a,b){return a=a||"",a=a.replace("data:",""),a=a.replace(";base64,",""),a=a.replace(b,"")}function g(a,b,c){b=b||"",c=c||512,a=f(a,b);for(var d=atob(a),e=[],g=0;g<d.length;g+=c){for(var h=d.slice(g,g+c),i=new Array(h.length),j=0;j<h.length;j++)i[j]=h.charCodeAt(j);var k=new Uint8Array(i);e.push(k)}return new Blob(e,{type:b})}a.x=a.x?a.x:0,a.y=a.y?a.y:0,a.width=a.width?a.width:400,a.height=a.height?a.height:300,a.scale=a.scale?a.scale:1,a.angle=a.angle?a.angle:0;var b=a.width/a.height*15+"px",c=a.width/a.height*40+"px",d=$('<span class="glyphicon  glyphicon-remove mr-remove " ></span>');$(a.section).find("h2").css("font-size",b),$(a.section).find(".fa-photo").css("font-size",c),$(".mr-upload-btn-section").click(function(a){a.preventDefault(),$(this).parent().siblings("input:file").click()}),$(a.section).click(function(){0==$(this).find("img").length&&$(this).siblings("input:file").click()}),$(document).off("click.mrCropRemoveImg").on("click.mrCropRemoveImg",a.section+" .mr-remove",function(){var d,e;$(this).parents(".mr-section-base:eq(0)").length&&(d=$(this).parents(".mr-section-base:eq(0)")),d&&d.find(".mr-tmp-clear-block").length&&(e=d.find(".mr-tmp-clear-block").clone(),e.removeClass("hidden")),$(a.section).length&&($(a.section).empty().append(e),e.length&&(e.find("h2").css("font-size",b),e.find(".fa-photo").css("font-size",c)),$(a.id_input_file).replaceWith($(a.id_input_file).clone(!0)),d.find(".mr-remove-input").length&&d.find(".mr-remove-input").val(1))}),$(a.id_input_file).change(function(){$(this).siblings(".mr-data-inputs").find(".mr-x").val(a.x),$(this).siblings(".mr-data-inputs").find(".mr-y").val(a.y),$(this).siblings(".mr-data-inputs").find(".mr-w").val(a.width),$(this).siblings(".mr-data-inputs").find(".mr-h").val(a.height),$(this).siblings(".mr-data-inputs").find(".mr-scale").val(a.scale),$(this).siblings(".mr-data-inputs").find(".mr-angle").val(a.angle),e(this,$(this).siblings('[data-role="upload_image"]'))}),$.fn.init_crop=function(a){var b=$(this);$(this).one("load",function(){$(this).guillotine({width:a.width,height:a.height,eventOnChange:"guillotinechange"});var c=$(this).guillotine("getData");for(var d in c)$("#"+d).html(c[d]);a.nav_block.find(".mr-rotate-left").click(function(){b.guillotine("rotateLeft")}),a.nav_block.find(".mr-rotate-right").click(function(){b.guillotine("rotateRight")}),a.nav_block.find(".mr-fit").click(function(){b.guillotine("fit")}),a.nav_block.find(".mr-zoom-in").click(function(){b.guillotine("zoomIn")}),a.nav_block.find(".mr-zoom-out").click(function(){b.guillotine("zoomOut")}),$(this).on("guillotinechange",function(b,c,d){c.scale=parseFloat(c.scale.toFixed(4)),a.data_block.find(".mr-origin-height").val($(this).height()),a.data_block.find(".mr-origin-width").val($(this).width());for(var e in c)a.data_block.find(".mr-"+e).val(c[e])});var e=$(this).guillotine("getData");$(this).trigger("guillotinechange",e),$(this).guillotine("fit")}),$(this).prop("complete")&&$(this).trigger("load")}}